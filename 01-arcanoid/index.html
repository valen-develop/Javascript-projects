<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arcanoid</title>
    <style>
      body {
        background-color: rgb(222, 222, 222);
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      #canvas {
        border: 2px solid rgb(0, 0, 0);
        border-bottom: transparent;
        display: block;
        background-image: url('./assets/bkg.png');
      }
    </style>
  </head>
  <body>
    <canvas id="canvas"></canvas>

    <img hidden src="./assets/bricks.png" alt="" id="bricks" />
    <img hidden src="./assets/sprite.png" alt="" id="sprite" />

    <script type="module">
      import { GameConfig } from './js/GameConfig.js';
      import { Game } from './js/Game.js';
      import { Ball } from './js/Ball.js';
      import { Paddle } from './js/Paddle.js';
      import { Bricks } from './js/Bricks.js';

      const $canvas = document.getElementById('canvas');
      const $sprite = document.getElementById('sprite');
      const $bricks = document.getElementById('bricks');
      const game = new Game($canvas);
      const ball = new Ball(game.canvas);
      const bricks = new Bricks($bricks);
      bricks.create();
      const paddle = new Paddle($sprite, game.canvas);
      game.initContext('2D');

      function initEvents() {
        document.addEventListener('keydown', keyDownHandle);
        document.addEventListener('keyup', keyUpHandle);

        function keyDownHandle(e) {
          const { key } = e;
          if (key === 'Right' || key === 'ArrowRight') {
            paddle.setRightPress(true);
          } else if (key === 'Left' || key === 'ArrowLeft') {
            paddle.setLeftPress(true);
          }
        }

        function keyUpHandle(e) {
          const { key } = e;
          if (key === 'Right' || key === 'ArrowRight') {
            paddle.setRightPress(false);
          } else if (key === 'Left' || key === 'ArrowLeft') {
            paddle.setLeftPress(false);
          }
        }
      }

      function draw() {
        // GAME
        game.clearCanvas();

        // BALL
        ball.draw(game.ctx);
        ball.move(paddle);

        // PADDLE
        paddle.draw(game.ctx);
        paddle.onMove();

        // BRICKS
        bricks.draw(game.ctx);
        bricks.onColision(ball);

        // UPDATE
        window.requestAnimationFrame(draw);
      }

      draw();
      initEvents();
    </script>
  </body>
</html>
